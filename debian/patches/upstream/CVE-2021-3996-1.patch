Backport of:

From 166e87368ae88bf31112a30e078cceae637f4cdb Mon Sep 17 00:00:00 2001
From: Karel Zak <kzak@redhat.com>
Date: Tue, 4 Jan 2022 10:37:55 +0100
Subject: [PATCH] libmount: remove support for deleted mount table entries

The "(deleted)" suffix has been originally used by kernel for deleted
mountpoints. Since kernel commit 9d4d65748a5ca26ea8650e50ba521295549bf4e3
(Dec 2014) kernel does not use this suffix for mount stuff in /proc at
all. Let's remove this support from libmount too.

Signed-off-by: Karel Zak <kzak@redhat.com>
---
 libmount/docs/libmount-sections.txt |  1 -
 libmount/src/fs.c                   | 11 -----------
 libmount/src/libmount.h.in          |  1 -
 libmount/src/libmount.sym           |  1 -
 libmount/src/mountP.h               |  1 -
 libmount/src/tab_parse.c            |  7 -------
 misc-utils/findmnt.c                | 19 +------------------
 7 files changed, 1 insertion(+), 40 deletions(-)

--- a/libmount/src/tab_parse.c
+++ b/libmount/src/tab_parse.c
@@ -227,11 +227,6 @@ static int mnt_parse_mountinfo_line(stru
 		goto fail;
 	}
 
-	/* remove "\040(deleted)" suffix */
-	p = (char *) endswith(fs->target, PATH_DELETED_SUFFIX);
-	if (p && *p)
-		*p = '\0';
-
 	s = skip_separator(s);
 
 	/* (6) vfs options (fs-independent) */
